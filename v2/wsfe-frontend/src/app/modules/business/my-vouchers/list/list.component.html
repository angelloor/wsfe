<!-- Main -->
<div class="flex-auto">

    <!-- Header -->
    <div class="flex flex-col sm:flex-row md:flex-col flex-auto justify-between py-6 px-6 md:px-6 border-b">
        <!-- Main actions -->
        <form [formGroup]="myVouchersForm" class="flex items-center mt-4">
            <!-- Search -->
            <div class="flex-auto" *ngIf="statusSearch">
                <!-- dateRange -->
                <div class="w-full">
                    <mat-form-field class="angel-mat-no-subscript h-12" [ngClass]=" isScreenSmall ?'w-52' : 'w-72' "
                        appearance="fill">
                        <mat-date-range-input [rangePicker]="dateRange">
                            <input matStartDate [formControlName]="'startDate'" (dateChange)="dateChange(0)">
                            <input matEndDate [formControlName]="'endDate'" (dateChange)="dateChange(1)">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matSuffix [for]="dateRange">
                        </mat-datepicker-toggle>
                        <mat-date-range-picker #dateRange></mat-date-range-picker>
                    </mat-form-field>
                </div>
            </div>
            <div class="flex-auto font-size-21" *ngIf="!statusSearch">
                <mat-form-field class="angel-mat-dense angel-mat-no-subscript w-full min-w-50 h-12">
                    <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:search'"></mat-icon>
                    <input matInput [formControl]="searchInputControl" [autocomplete]="'off'" class="flex-auto"
                        [placeholder]="'Buscar por clave de acceso | numero de comprobante'">
                </mat-form-field>
            </div>
            <button mat-icon-button [matMenuTriggerFor]="vouchersActions" *ngIf="vouchersSelection.selected.length > 0">
                <mat-icon [svgIcon]="'mat_outline:menu'"></mat-icon>
            </button>
            <button mat-icon-button (click)="changeStatusSearch(statusSearch)">
                <mat-icon [svgIcon]="!statusSearch ? 'heroicons_outline:calendar' : 'heroicons_outline:search'">
                </mat-icon>
            </button>
            <mat-menu [xPosition]="'before'" #vouchersActions="matMenu">
                <button mat-menu-item (click)="downloadVouchers('xml')">
                    <mat-icon [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                    <span>Descargar XMLs</span>
                </button>
                <button mat-menu-item (click)="downloadVouchers('pdf')">
                    <mat-icon [svgIcon]="'heroicons_outline:document'"></mat-icon>
                    <span>Descargar PDFs</span>
                </button>
            </mat-menu>

        </form>
        <div class="font-medium text-secondary mt-4">
            <ng-container *ngIf="count > 0">
                {{count}}
            </ng-container>
            {{count | i18nPlural: {
            '=0' : 'No hay comprobantes',
            '=1' : 'comprobante',
            'other': 'comprobante'
            } }}
        </div>
    </div>
    <div class="w-full h-auto">
        <ng-container *ngIf="vouchers$ | async as vouchers">
            <ng-container *ngIf="vouchers.length; else noResults">
                <table mat-table [dataSource]="vouchersSource" class="mat-elevation-z8 w-full">
                    <ng-container matColumnDef="select">
                        <th mat-header-cell *matHeaderCellDef>
                            <mat-checkbox (change)="$event ? masterToggle() : null"
                                [checked]="vouchersSelection.hasValue() && isAllSelected()"
                                [indeterminate]="vouchersSelection.hasValue() && !isAllSelected()"
                                [aria-label]="checkboxLabel()">
                            </mat-checkbox>
                        </th>
                        <td mat-cell *matCellDef="let rowVoucher">
                            <mat-checkbox (click)="$event.stopPropagation()"
                                (change)="$event ? vouchersSelection.toggle(rowVoucher) : null"
                                [checked]="vouchersSelection.isSelected(rowVoucher)"
                                [aria-label]="checkboxLabel(rowVoucher)">
                            </mat-checkbox>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="number_voucher">
                        <th mat-header-cell *matHeaderCellDef>Comprobante</th>
                        <td mat-cell *matCellDef="let voucher">
                            {{voucher.number_voucher}} </td>
                    </ng-container>
                    <ng-container matColumnDef="access_key_voucher">
                        <th mat-header-cell *matHeaderCellDef>Clave de acceso</th>
                        <td mat-cell *matCellDef="let voucher">{{voucher.access_key_voucher}} </td>
                    </ng-container>
                    <ng-container matColumnDef="emission_date_voucher">
                        <th mat-header-cell *matHeaderCellDef>Fecha de emisión</th>
                        <td mat-cell *matCellDef="let voucher"> {{voucher.emission_date_voucher | date:'short' }} </td>
                    </ng-container>
                    <ng-container matColumnDef="internal_status_voucher">
                        <th mat-header-cell *matHeaderCellDef>Estado</th>
                        <td mat-cell *matCellDef="let voucher">
                            {{getTypeSelectVoucherStatus(voucher.internal_status_voucher).name_type}} </td>
                    </ng-container>
                    <ng-container matColumnDef="authorization_date_voucher">
                        <th mat-header-cell *matHeaderCellDef>Fecha de autorización</th>
                        <td mat-cell *matCellDef="let voucher"> {{ (voucher.authorization_date_voucher ?
                            (voucher.authorization_date_voucher | date:'short') :
                            getTypeSelectVoucherStatus(voucher.internal_status_voucher).name_type)}}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="importeTotal">
                        <th mat-header-cell *matHeaderCellDef>Importe total</th>
                        <td mat-cell *matCellDef="let voucher"> {{voucher.body_voucher.importeTotal}} </td>
                    </ng-container>
                    <ng-container matColumnDef="information">
                        <th mat-header-cell *matHeaderCellDef>Información</th>
                        <td mat-cell *matCellDef="let voucher">
                            <button mat-icon-button (click)="openInfoVoucher(voucher)">
                                <mat-icon [svgIcon]="'mat_outline:info'"></mat-icon>
                            </button>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="preview">
                        <th mat-header-cell *matHeaderCellDef>Opciones</th>
                        <td mat-cell *matCellDef="let voucher">
                            <button mat-icon-button [matMenuTriggerFor]="voucherActions">
                                <mat-icon [svgIcon]="'mat_outline:menu'"></mat-icon>
                            </button>
                            <mat-menu [xPosition]="'before'" #voucherActions="matMenu">
                                <button mat-menu-item (click)="preview(voucher)" *ngIf="voucher.action_pdf_voucher">
                                    <mat-icon [svgIcon]="'mat_outline:preview'"></mat-icon>
                                    <span>Vista previa RIDE</span>
                                </button>
                                <button mat-menu-item (click)="downloadVoucher(voucher, 'xml')">
                                    <mat-icon [svgIcon]="'heroicons_outline:document-text'"></mat-icon>
                                    <span>Descargar XML</span>
                                </button>
                                <button mat-menu-item (click)="downloadVoucher(voucher, 'pdf')"
                                    *ngIf="voucher.action_pdf_voucher">
                                    <mat-icon [svgIcon]="'heroicons_outline:document'"></mat-icon>
                                    <span>Descargar PDF</span>
                                </button>
                            </mat-menu>
                        </td>
                    </ng-container>
                    <tr mat-header-row
                        *matHeaderRowDef="isScreenSmall ? displayedColumnsScreenSmall : displayedColumns"></tr>
                    <tr mat-row
                        *matRowDef="let rowVoucher; columns: isScreenSmall ? displayedColumnsScreenSmall : displayedColumns;"
                        (click)="vouchersSelection.toggle(rowVoucher)">
                    </tr>
                </table>

                <mat-paginator [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator>

            </ng-container>
        </ng-container>

        <!-- No Results -->
        <ng-template #noResults>
            <div class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center">¡No hay
                resultados!</div>
        </ng-template>
    </div>
</div>