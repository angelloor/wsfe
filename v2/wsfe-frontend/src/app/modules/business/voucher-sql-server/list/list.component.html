<!-- Main -->
<div class="flex-auto">

    <!-- Header -->
    <div class="flex flex-col sm:flex-row md:flex-col flex-auto justify-between py-6 px-6 md:px-6 border-b">
        <!-- Main actions -->
        <form [formGroup]="myVouchersForm" class="flex items-center mt-4">
            <!-- Search -->
            <div class="flex-auto" *ngIf="statusSearch">
                <!-- dateRange -->
                <mat-form-field class="angel-mat-no-subscript h-12 mr-4 mt-4"
                    [ngClass]=" isScreenSmall ?'w-52' : 'w-72'" appearance="fill">
                    <mat-date-range-input [rangePicker]="dateRange">
                        <input matStartDate [formControlName]="'emission_date_voucher'" (dateChange)="dateChange(0)">
                        <input matEndDate [formControlName]="'authorization_date_voucher'" (dateChange)="dateChange(1)">
                    </mat-date-range-input>
                    <mat-datepicker-toggle matSuffix [for]="dateRange">
                    </mat-datepicker-toggle>
                    <mat-date-range-picker #dateRange></mat-date-range-picker>
                </mat-form-field>
                <!-- id_institution -->
                <mat-form-field class="angel-mat-no-subscript mr-4 mt-4" [ngClass]="isScreenSmall ?'w-52' : 'w-72'">
                    <mat-select [formControlName]="'id_institution'" (selectionChange)="searchVouchers()">
                        <ng-container *ngFor="let institution of institutionSQLServer">
                            <mat-option [value]="institution.id_institution">
                                {{institution.name_institution}}</mat-option>
                        </ng-container>
                    </mat-select>
                </mat-form-field>
                <!-- internal_status_voucher -->
                <mat-form-field class="angel-mat-no-subscript mr-4 mt-4" [ngClass]="isScreenSmall ?'w-52' : 'w-72'">
                    <mat-select [formControlName]="'internal_status_voucher'" (selectionChange)="searchVouchers()">
                        <ng-container *ngFor="let type of typeVoucherStatus">
                            <mat-option [value]="type.value_type">
                                {{type.name_type}}</mat-option>
                        </ng-container>
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="flex-auto font-size-21" *ngIf="!statusSearch">
                <mat-form-field class="angel-mat-dense angel-mat-no-subscript w-full min-w-50 h-12">
                    <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:search'"></mat-icon>
                    <input matInput [formControl]="searchInputControl" [autocomplete]="'off'" class="flex-auto"
                        [placeholder]="'Buscar por numero de Comprobante'">
                </mat-form-field>
            </div>
            <div id="Options" class="flex flex-col ml-3">
                <button mat-icon-button [matTooltip]="'Generar reporte detallado'"
                    (click)="reportVouchersOfSQLServer()">
                    <mat-icon [svgIcon]="'heroicons_solid:document-text'"></mat-icon>
                </button>
                <button mat-icon-button [matTooltip]="'Generar reporte consolidado'"
                    (click)="reportResumeVouchersOfSQLServer()">
                    <mat-icon [svgIcon]="'heroicons_solid:document-report'"></mat-icon>
                </button>

                <button mat-icon-button (click)="changeStatusSearch(statusSearch)">
                    <mat-icon [svgIcon]="!statusSearch ? 'heroicons_outline:calendar' : 'heroicons_outline:search'">
                    </mat-icon>
                </button>
            </div>
        </form>

    </div>
    <div class="w-full h-auto">
        <ng-container *ngIf="vouchersSQLServer$ | async as vouchersSQLServer">
            <ng-container *ngIf="vouchersSQLServer.length; else noResults">
                <table mat-table [dataSource]="vouchersSourceSQLServer" class="mat-elevation-z8 w-full">
                    <ng-container matColumnDef="fechaemision">
                        <th mat-header-cell *matHeaderCellDef>Fecha de emisión</th>
                        <td mat-cell *matCellDef="let voucher">
                            {{voucher.fechaemision | date:'short'}} </td>
                    </ng-container>
                    <ng-container matColumnDef="numerodocumento">
                        <th mat-header-cell *matHeaderCellDef>N° Comprobante</th>
                        <td mat-cell *matCellDef="let voucher">
                            {{voucher.numerodocumento}} </td>
                    </ng-container>
                    <ng-container matColumnDef="razonsocialcomprador">
                        <th mat-header-cell *matHeaderCellDef>Nombre</th>
                        <td mat-cell *matCellDef="let voucher"> {{ voucher.razonsocialcomprador }} </td>
                    </ng-container>
                    <ng-container matColumnDef="detalle">
                        <th mat-header-cell *matHeaderCellDef>Detalle</th>
                        <td mat-cell *matCellDef="let voucher">
                            {{voucher.detalle}} </td>
                    </ng-container>
                    <ng-container matColumnDef="total">
                        <th mat-header-cell *matHeaderCellDef>total</th>
                        <td mat-cell *matCellDef="let voucher"> {{(voucher.total + voucher.iva).toFixed(2) }} </td>
                    </ng-container>
                    <ng-container matColumnDef="estadointerno">
                        <th mat-header-cell *matHeaderCellDef>Estado</th>
                        <td mat-cell *matCellDef="let voucher"> {{voucher.estadointerno === null ?'Pendiente': 'Anulado'
                            }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="institution">
                        <th mat-header-cell *matHeaderCellDef>Institución</th>
                        <td mat-cell *matCellDef="let voucher"> {{voucher.institution}} </td>
                    </ng-container>
                    <tr mat-header-row
                        *matHeaderRowDef="isScreenSmall ? displayedColumnsScreenSmall : displayedColumns"></tr>
                    <tr mat-row
                        *matRowDef="let rowVoucher; columns: isScreenSmall ? displayedColumnsScreenSmall : displayedColumns;"
                        (click)="vouchersSelection.toggle(rowVoucher)">
                    </tr>
                </table>

                <mat-paginator [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator>

            </ng-container>
        </ng-container>

        <!-- No Results -->
        <ng-template #noResults>
            <div class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center">¡No hay
                resultados!</div>
        </ng-template>
    </div>
</div>